<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Russia City Speedrun - Survival Mode</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    html,body{height:100%;margin:0;font-family:'Segoe UI', Roboto, Helvetica, Arial, sans-serif;background:#0f1724;color:#e6eef8;overflow:hidden;}
    #map{height:100vh;width:100vw;position:relative;z-index: 1;}

    .overlay-start{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(15, 23, 42, 0.95);z-index:1000;}
    .start-box{background:#fff;color:#04263b;padding:40px;border-radius:24px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.6);max-width:450px; line-height: 1.6;}
    .start-box h2{margin:0 0 15px 0; color:#1e293b; font-size: 2rem;}

    .info-bar{position:absolute;top:15px;left:50%;transform:translateX(-50%);background:rgba(15, 23, 42, 0.95);padding:12px 30px;border-radius:18px;display:flex;gap:25px;z-index:900;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.15);box-shadow:0 8px 32px rgba(0,0,0,0.5);}
    .info-item{display:flex;flex-direction:column;align-items:center; min-width: 70px;}
    .info-label{font-size:0.7rem;text-transform:uppercase;letter-spacing:1.5px;opacity:0.6;margin-bottom:4px;}
    .info-value{font-size:1.3rem;font-weight:800; font-variant-numeric: tabular-nums;}

    .status-alive{color: #22c55e; text-shadow: 0 0 15px rgba(34,197,94,0.8);}
    .status-dead{color: #ef4444; text-shadow: 0 0 15px rgba(239,68,68,0.8); animation: blink 0.8s infinite;}

    .city-title{position:absolute;top:120px;left:50%;transform:translateX(-50%);z-index:1001;font-size:2.5rem;font-weight:900;color:#fff;text-shadow:0 0 25px rgba(0,0,0,1), 4px 4px 0px #e11d48;pointer-events:none;text-align:center;width:100%;}

    .btn{background:#e11d48;color:#fff;border:none;padding:16px 32px;border-radius:14px;font-weight:700;cursor:pointer;font-size:1.1rem;transition:0.2s; margin-top: 15px;}
    .btn:hover{background:#be123c; transform: translateY(-2px);}

    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.92);display:flex;align-items:center;justify-content:center;z-index:2000;backdrop-filter:blur(12px);}
    .modal{background:#fff;color:#04263b;padding:45px;border-radius:28px;width:380px;text-align:center;}

    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
  </style>
</head>
<body>

  <div id="map"></div>

  <div class="info-bar">
    <div class="info-item"><span class="info-label">Time</span><span id="time" class="info-value">00:00</span></div>
    <div class="info-item"><span class="info-label">Progress</span><span class="info-value"><span id="progress">0</span>/30</span></div>
    <div class="info-item"><span class="info-label">Score</span><span id="score" class="info-value">0</span></div>
    <div class="info-item" id="statusBox" style="display:none;"><span class="info-label">Status</span><span id="aliveStatus" class="info-value status-alive">ALIVE</span></div>
  </div>

  <div id="overlayStart" class="overlay-start">
    <div class="start-box">
      <h2>Russia City Speedrun</h2>
      <p><b>Survival Rules:</b><br>Russia is vast! Your click must be within <b>100km</b> of the target city.<br>If you miss, you are "OUT", but you can keep playing for practice.</p>
      <button id="startBtn" class="btn">Start Russian Run</button>
    </div>
  </div>

  <div class="city-title" id="cityTitle" style="display:none"></div>

  <div id="endModal" style="display:none" class="modal-backdrop">
    <div class="modal">
      <h2 id="resultTitle" style="font-size: 2rem; margin-bottom: 10px;">End of Route</h2>
      <div id="stats" style="font-size:1.2rem; margin: 25px 0; color: #475569; line-height: 1.5;"></div>
      <button id="playAgainBtn" class="btn">Try Again</button>
    </div>
  </div>

  <script>
    const RUSSIA_CITIES = [
        {name:"Moscow (Москва)",coords:[55.7558,37.6173]},{name:"Saint Petersburg (Санкт-Петербург)",coords:[59.9343,30.3351]},{name:"Novosibirsk (Новосибирск)",coords:[55.0084,82.9357]},{name:"Yekaterinburg (Екатеринбург)",coords:[56.8389,60.6057]},{name:"Kazan (Казань)",coords:[55.7887,49.1221]},{name:"Nizhny Novgorod (Нижний Новгород)",coords:[56.3269,44.0059]},{name:"Chelyabinsk (Челябинск)",coords:[55.1644,61.4368]},{name:"Samara (Самара)",coords:[53.2029,50.1508]},{name:"Omsk (Омск)",coords:[54.9885,73.3242]},{name:"Rostov-on-Don (Ростов-на-Дону)",coords:[47.2357,39.7015]},{name:"Ufa (Уфа)",coords:[54.7388,55.9721]},{name:"Krasnoyarsk (Красноярск)",coords:[56.0153,92.8932]},{name:"Voronezh (Воронеж)",coords:[51.6608,39.2003]},{name:"Perm (Пермь)",coords:[58.0105,56.2502]},{name:"Volgograd (Волгоград)",coords:[48.708,44.5133]},{name:"Krasnodar (Краснодар)",coords:[45.0393,38.9872]},{name:"Saratov (Саратов)",coords:[51.5336,46.0342]},{name:"Tyumen (Тюмень)",coords:[57.1522,65.5272]},{name:"Murmansk (Мурманск)",coords:[68.9585,33.0827]},{name:"Izhevsk (Ижевск)",coords:[56.8498,53.2045]},{name:"Yakutsk (Якутск)",coords:[62.0355,129.6755]},{name:"Irkutsk (Иркутск)",coords:[52.287,104.305]},{name:"Yuzhno-Sakhalinsk (Южно-Сахалинск)",coords:[46.959,142.738]},{name:"Khabarovsk (Хабаровск)",coords:[48.4726,135.0577]},{name:"Vladivostok (Владивосток)",coords:[43.1198,131.8869]},{name:"Yaroslavl (Ярославль)",coords:[57.6261,39.8845]},{name:"Orenburg (Оренбург)",coords:[51.7666,55.0988]},{name:"Tomsk (Томск)",coords:[56.4977,84.9744]},{name:"Yelizovo (Елизово)",coords:[53.1831,158.3894]},{name:"Astrakhan (Астрахань)",coords:[46.3476,48.0302]}
    ];

    let cities=[], index=0, started=false, answered=false, markers=[], circles=[], score=0, startTime=null, timerInterval=null;
    let isGameOver = false, deathCity = "", currentCityMarker = null;

    const map = L.map('map', {zoomControl:false}).setView([60, 95], 3);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png').addTo(map);

    const timeEl=document.getElementById('time'), progressEl=document.getElementById('progress');
    const scoreEl=document.getElementById('score'), aliveStatusEl=document.getElementById('aliveStatus');
    const cityTitle=document.getElementById('cityTitle'), endModal=document.getElementById('endModal');

    function haversine(a,b){const R=6371;const dLat=(b[0]-a[0])*Math.PI/180, dLon=(b[1]-a[1])*Math.PI/180;const aa=Math.sin(dLat/2)**2 + Math.cos(a[0]*Math.PI/180)*Math.cos(b[0]*Math.PI/180)*Math.sin(dLon/2)**2;return R*2*Math.atan2(Math.sqrt(aa),Math.sqrt(1-aa));}

    function resetGame(){cities=[...RUSSIA_CITIES].sort(()=>Math.random()-0.5);index=0;score=0;started=false;isGameOver=false;deathCity="";clearMapObjects();progressEl.textContent="0";scoreEl.textContent="0";timeEl.textContent="00:00";aliveStatusEl.textContent="ALIVE";aliveStatusEl.className="info-value status-alive";document.getElementById('statusBox').style.display='none';if(timerInterval) clearInterval(timerInterval);document.getElementById('overlayStart').style.display='flex';endModal.style.display='none';cityTitle.style.display='none';map.setView([60,95],3);}

    function startGame(){document.getElementById('overlayStart').style.display='none';document.getElementById('statusBox').style.display='flex';started=true;startTime=Date.now();timerInterval=setInterval(()=>{const diff=Date.now()-startTime;timeEl.textContent=`${String(Math.floor(diff/60000)).padStart(2,'0')}:${String(Math.floor((diff%60000)/1000)).padStart(2,'0')}`;},1000);showNextCity();}

    function showNextCity(){answered=false;progressEl.textContent=index+1;cityTitle.textContent=cities[index].name;cityTitle.style.display='block';map.flyTo([60,95],3,{duration:1});}

    map.on('click',function(e){if(!started||answered)return;answered=true;const city=cities[index],clickCoords=[e.latlng.lat,e.latlng.lng];const dist=haversine(clickCoords,city.coords);markers.push(L.circleMarker(clickCoords,{radius:8,color:'#3b82f6',fillOpacity:1}).addTo(map));circles.push(L.circle(city.coords,{radius:100000,color:'#22c55e',weight:3,fillOpacity:0.2}).addTo(map));currentCityMarker=L.marker(city.coords).addTo(map).bindPopup(`<b>${city.name}</b><br>${dist.toFixed(1)} km`).openPopup();if(dist<=100){score+=Math.max(10,Math.round(100-(dist/10)*5));scoreEl.textContent=score;}else if(!isGameOver){isGameOver=true;deathCity=city.name;aliveStatusEl.textContent="OUT";aliveStatusEl.className="info-value status-dead";}map.flyTo(city.coords,6,{duration:0.8});setTimeout(()=>{clearMapObjects();index++;if(index<30){showNextCity();}else{endGame();}},2000);});

    function clearMapObjects(){markers.forEach(m=>map.removeLayer(m));markers=[];circles.forEach(c=>map.removeLayer(c));circles=[];if(currentCityMarker){map.removeLayer(currentCityMarker);currentCityMarker=null;}}

    function endGame(){started=false;clearInterval(timerInterval);cityTitle.style.display='none';const stats=document.getElementById('stats');const resultTitle=document.getElementById('resultTitle');if(isGameOver){resultTitle.textContent="Eliminated!";resultTitle.style.color="#ef4444";stats.innerHTML=`You failed at <b>${deathCity}</b>.<br><br>Final Score: <b>${score}</b><br>Total Time: <b>${timeEl.textContent}</b>`;}else{resultTitle.textContent="Survivor!";resultTitle.style.color="#22c55e";stats.innerHTML=`You completed the Russian challenge!<br><br>Final Score: <b>${score}</b><br>Total Time: <b>${timeEl.textContent}</b>`;}endModal.style.display='flex';}

    document.getElementById('startBtn').addEventListener('click',startGame);
    document.getElementById('playAgainBtn').addEventListener('click',resetGame);
    resetGame();
  </script>
</body>
</html>
